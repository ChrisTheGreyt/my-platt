version: 1
applications:
  - appRoot: ttc-app
    frontend:
      phases:
        preBuild:
          commands:
            # Clean the npm cache and remove existing modules
            - npm cache clean --force
            - rm -rf node_modules package-lock.json
            # Install all dependencies including dev dependencies
            - npm install
            # Install TailwindCSS and its dependencies
            - npm install tailwindcss postcss autoprefixer --save
            # Initialize TailwindCSS if config doesn't exist
            - npx tailwindcss init -p
            # Add environment variable
            - echo "DISABLE_UPLOAD=true" >> .env
        build:
          commands:
            # Set NODE_PATH to help with module resolution
            - export NODE_PATH=$NODE_PATH:$(pwd)/node_modules
            - NODE_ENV=production npm run build
      artifacts:
        baseDirectory: .next
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*
          - .npm/**/* 
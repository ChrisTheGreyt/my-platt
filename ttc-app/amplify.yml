version: 1
applications:
  - appRoot: ttc-app
    frontend:
      phases:
        preBuild:
          commands:
            - npm cache clean --force
            - rm -rf node_modules package-lock.json
            # Install dependencies in correct order
            - npm install
            # Install TailwindCSS with exact version
            - npm install --save-exact tailwindcss@3.4.1 postcss@8.4.35 autoprefixer@10.4.17
            - npm install -D @types/react@18.2.25 @types/react-dom@18.2.0 @types/node typescript
            # Create config files directly without using tailwindcss init
            - |
              cat << EOF > tailwind.config.js
              /** @type {import('tailwindcss').Config} */
              module.exports = {
                content: [
                  './src/components/Navbar/**/*.{js,ts,jsx,tsx}',  // Explicitly include Navbar
                  './src/app/**/*.{js,ts,jsx,tsx}',
                  './src/pages/**/*.{js,ts,jsx,tsx}',
                  './src/components/**/*.{js,ts,jsx,tsx}',
                  './src/**/*.{js,ts,jsx,tsx}'
                ],
                theme: {
                  extend: {},
                },
                plugins: [],
              }
              EOF
            - |
              cat << EOF > postcss.config.js
              module.exports = {
                plugins: {
                  tailwindcss: require('tailwindcss'),
                  autoprefixer: require('autoprefixer')
                }
              }
              EOF
            - |
              cat << EOF > next.config.js
              /** @type {import('next').NextConfig} */
              const path = require('path');
              
              module.exports = {
                webpack: (config) => {
                  config.resolve.alias = {
                    ...config.resolve.alias,
                    '@': path.join(__dirname, 'src')
                  };
                  return config;
                }
              };
              EOF
            - |
              cat << EOF > tsconfig.json
              {
                "compilerOptions": {
                  "target": "es5",
                  "lib": ["dom", "dom.iterable", "esnext"],
                  "allowJs": true,
                  "skipLibCheck": true,
                  "strict": true,
                  "noEmit": true,
                  "esModuleInterop": true,
                  "module": "esnext",
                  "moduleResolution": "node",
                  "resolveJsonModule": true,
                  "isolatedModules": true,
                  "jsx": "preserve",
                  "incremental": true,
                  "paths": {
                    "@/*": ["./src/*"]
                  },
                  "baseUrl": "."
                },
                "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
                "exclude": ["node_modules"]
              }
              EOF
            - |
              cat << EOF > src/app/globals.css
              @tailwind base;
              @tailwind components;
              @tailwind utilities;
              EOF
            - npm list tailwindcss postcss autoprefixer
            - npm list @types/react @types/react-dom
        build:
          commands:
            - npm install --save-exact tailwindcss@3.4.1 postcss@8.4.35 autoprefixer@10.4.17
            - NODE_ENV=production npm run build
      artifacts:
        baseDirectory: .next
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/* 